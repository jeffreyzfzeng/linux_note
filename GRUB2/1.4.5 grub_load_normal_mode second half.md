# grub\_load\_normal\_mode second half

`grub_dl_resolve_symbols` resoloves symbols of the module. It finds the section with symbos table included.

```c
static grub_err_t
grub_dl_resolve_symbols (grub_dl_t mod, Elf_Ehdr *e)
{

  ......
  
  for (i = 0, s = (Elf_Shdr *) ((char *) e + e->e_shoff);
       i < e->e_shnum;
       i++, s = (Elf_Shdr *) ((char *) s + e->e_shentsize))
    if (s->sh_type == SHT_SYMTAB)
      break;
  
  ......
  
}
```

after allocates memory for symbols table in module data, resolves symbols of the module. 

Initialize and finalize function of the module are resolved in this procedure as well.

```c
static grub_err_t
grub_dl_resolve_symbols (grub_dl_t mod, Elf_Ehdr *e)
{
  ......
  
    for (i = 0;
       i < size / entsize;
       i++, sym = (Elf_Sym *) ((char *) sym + entsize))
    {
      unsigned char type = ELF_ST_TYPE (sym->st_info);
      unsigned char bind = ELF_ST_BIND (sym->st_info);
      const char *name = str + sym->st_name;

      switch (type)
	{
	
	......
        
	  if (grub_strcmp (name, "grub_mod_init") == 0)
	    mod->init = (void (*) (grub_dl_t)) sym->st_value;
	  else if (grub_strcmp (name, "grub_mod_fini") == 0)
	    mod->fini = (void (*) (void)) sym->st_value;
	  break;

       ......
       
	}
    }
  
  ......
}
```

`grub_arch_dl_relocate_symbols` relocates symbols base on hardware architecture. DIfferent archtectures has its own implementation of this routine.



