grub_main: grub_load_modules
==============================================================================================================

Ahead grub_load_modules, we ignore some of grub functions, the functions are not important to learning grub.

```Hello
grub-core/kern/main.c:213

  /* Hello.  */
  grub_setcolorstate (GRUB_TERM_COLOR_HIGHLIGHT);
  grub_printf ("Welcome to GRUB!\n\n");
  grub_setcolorstate (GRUB_TERM_COLOR_STANDARD);
```
Above 3 functions print Welcome to GRUB! on console.
![](/assets/Welcome to GRUB!.png)

```register_symbols
grub-core/kern/main.c:218

  /* Load pre-loaded modules and free the space.  */
  grub_register_exported_symbols ();
```

Function grub_register_exported_symbols could be found in grub-core/symlist.c, symlist.c is automatically generated by gensymlist.sh when compiling gurb source code. Inside grub_register_exported_symbols, it calculates a hash key value based on the name of specific symbol and saves the symbol information to a simple hash table: grub_symtab.


All loaded modules will be stored in grub_dl_head, it's a global variable. Before executing grub_load_modules, no modules stored in it, after load first module successfully, check it again, we can find fshelp stored in it. GRUB consists of several images: a variety of bootstrap images for starting GRUB in various ways, a kernel image, and a set of modules which are combined with the kernel image to form a core image, what grub_load_modules do is load modules included in core image.

```grub_load_modules
-------------------------------------------------------------------------------------------------------------

-------------------------------------------------------------------------------------------------------------
grub-core/kern/main.c:50

/* Load all modules in core.  */
static void
grub_load_modules (void)
{
  struct grub_module_header *header;
  FOR_MODULES (header)
  {
(gdb) p grub_dl_head
$1 = (grub_dl_t) 0x0
    /* Not an ELF module, skip.  */
    if (header->type != OBJ_TYPE_ELF)
      continue;

    if (! grub_dl_load_core ((char *) header + sizeof (struct grub_module_header),
                             (header->size - sizeof (struct grub_module_header))))
      grub_fatal ("%s", grub_errmsg);
(gdb) p grub_errno 
$2 = GRUB_ERR_NONE
(gdb) p grub_dl_head->name
$4 = 0x7ffc990 "fshelp"
    if (grub_errno)
      grub_print_error ();
  }
}

```